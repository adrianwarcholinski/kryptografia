#include <iostream>
#include <cstdlib>
#include <string>
#include <fstream>
#include <bitset>
#include "../include/BigInt.h"
#include "../include/Math.h"
using namespace std;

void wyswietlNaglowek() {
    cout << "Algorytm szyfrowania AES." << endl
         << "Autorzy:" << endl
         << "Aleksandra Ruta" << endl
         << "Adrian Warcholinski" << endl
         << "Kamil Piatkowski" << endl;
}

void wczytajDane(string &tresc) {
    short wybor;
    string tekst="";
    cout << "Podaj metode wprowadzania danych:" << endl
         << "[1] Tekst wprowadzony z klawiatury" << endl
         << "[2] Tekst wczytywany z pliku" << endl
         << "Wybierz opcje: ";
    while(true) {
        cin >> wybor;
        cin.ignore();
        if((wybor == 1) || (wybor == 2)) {
            break;
        } else {
            cout << "Nieprawidlowa opcja. Wybierz opcje: ";
        }
    }
    if(wybor == 1) {
        cout << "Wprowadz tekst:";
        getline(cin, tekst);
        tresc = tekst;
    }
    else if(wybor == 2) {
        fstream plik;
        plik.open("../dane.txt", ios::in );
        if( plik.good() ) {
            getline(plik, tresc);
            plik.close();
        } else cout << "Blad - nie udalo sie otworzyc pliku dane.txt" << endl;
    }
}


int main() {
    wyswietlNaglowek();
    string tekst;
    bitset<1024> bits("10000");

    string szyfrowanaLiczbaString;
    cout << "Wpisz szyfrowana liczbe: ";
    cin >> szyfrowanaLiczbaString;
    BigInt szyfrowanaLiczba(szyfrowanaLiczbaString);

    string veryVeryVERYBIGNUMBER = "99999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999999";

//    BigInt p = Math::fastPower(2, veryVeryVERYBIGNUMBER , 607) - 1;
    BigInt p = 229;
    cout << "Wykonuje test pierwszosci..." << endl;
    bool isPrime = Math::isPrime(p); // Liczba 2^607 -1 jest pierwsza!
    if(isPrime) {
        cout << "Liczba p przeszla test pierwszosci Fermata." << endl;
        BigInt a("70");
        BigInt g("6");
        BigInt b = Math::fastPower(g, p, a);
        BigInt k("127");
        BigInt temp = p-1;
        BigInt temp2("1");
//        while(true) {
//            k = k + 2;
//            if(Math::NWD(k, temp) == temp2) {
//                break;
//            }
//        }
//            cout << "Wzglednie pierwsze" << endl;
        cout << "Wyznaczam C1 i C2..." << endl;
        BigInt c1 = Math::fastPower(g, p, k);
        BigInt c2 = (szyfrowanaLiczba * Math::fastPower(b, veryVeryVERYBIGNUMBER, k)) % p;

        cout << "Kryptogram: " << endl;
        cout << "C1: " << c1 << endl;
        cout << "C2: " << c2 << endl;
        cout << "Deszyfrowanie... " << endl;

        BigInt c1doa = Math::fastPower(c1, veryVeryVERYBIGNUMBER, a);// c1^a
        c1doa = Math::fastPower(c1doa, veryVeryVERYBIGNUMBER, p-2);
        c1doa = c1doa * c2;
        BigInt d = c1doa % p;
        cout << "Tekst jawny: " << endl;
        cout << d << endl;
    } else {
        cout << "Liczba nie przeszla testu pierwszosci Fermata." << endl;
    }
    //wczytajDane(tekst);
    return 0;
}